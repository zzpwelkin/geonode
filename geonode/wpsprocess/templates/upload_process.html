{% extends "process_base.html" %}
{% load i18n %}
{% load bootstrap_tags %}
{% load layers_tags %}
{% load staticfiles %}
{% load future %}

{% block title %} {% trans "Upload Profile"  %} â€” {{ block.super }} {% endblock %}

{% block body_class %}data upload{% endblock body_class %}

{% block head %}
{% comment %}
  {% include "geonode/ext_header.html" %}
  {% include "geonode/app_header.html" %}
  {% include "geonode/geo_header.html" %}
 {% endcomment %}
  {{ block.super }}
  
  <script type="text/javascript" src="{{STATIC_URL}}libs/js/jquery-1.8.0.js"></script>
 {% for fieldset in form.manytomany_field %}
   <script type="text/javascript" >
$(document).ready(function(){
	$('#id_{{fieldset.prefix}}_add').bind('click', function(event)
	{	
		if (!event) event = window.event;
		var form_count = $('input#id_{{fieldset.prefix}}-TOTAL_FORMS').attr('value')
		var form = '{{ fieldset.empty_form|escapejs}}'.replace(/__prefix__/g, form_count);	
		// append node
		$('div#id_{{fieldset.prefix}}').append('<div><fieldset class=""><p>'+form+'</p></fieldset></div>');
		//$(this).after('<div><fieldset class=""><p>'+form+'</p></fieldset></div>');
		//$('.hide_form_below').toggle(function(){
		//	$(this).parent().find('fieldset').hide();
		//},function(){
		//	$(this).parent().find('fieldset').show();
		//});
		
		// change the value of {{form.Atitle.prefix}}-TOTAL_FORMS
		$('input#id_{{fieldset.prefix}}-TOTAL_FORMS').each(function(){this.value = +this.value + 1 });		
	});
});
</script>
 {% endfor %} 

{% endblock %}

{% block body %}
  <div class="block">
    <div class="span8">
      <h2 class="page-title">{% trans "Upload Process" %}</h2>

	  {% if errors %}
	    <div id="errors">
	      {% for error in errors %}
	        <div>{{ error }}</div>
	      {% endfor %}
	    </div>
	  {% endif %}
	  
	  <form class="form-horizontal" method="POST">
    {% csrf_token %}
    <div class="form-controls">
      {{ form|as_bootstrap }}
    </div>
     {% for fieldset in form.manytomany_field %}
     <div id="id_{{fieldset.prefix}}">
		{{ fieldset.management_form }}
		<p>{{fieldset.prefix}} </p> 
		<a class='hide_form_below' href='javascript:void(0);'>hide</a>
		<img style="cursor:pointer"id="id_{{fieldset.prefix}}_add" src="/static/icon_add.gif" width="10" height="10" alt="Add Another" />
		{% if fieldset.total_form_count %}
		 {% for form_sub in fieldset.forms %}
		<div><fieldset class=""> {{form_sub|as_bootstrap}}</fieldset></div>
		{% endfor %}
		{%endif%}
	</div>
     {% endfor %}

    <div class="form-actions">
      <input type="submit" class="btn btn-primary" value="{% trans "Upload" %}"/>
    </div>
  		</form>
	</div>
</div>
{% endblock %}

{% block sidebar %}
<ul class="nav nav-list">
  <li class="nav-header">{% trans "Permissions" %}</li>
  <li class="form-inline">
    <div id="permissions_form"></div>
  </li>
</ul>
{% endblock %}
